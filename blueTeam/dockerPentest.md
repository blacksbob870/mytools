Zoâ€˜r! Endi **Docker-da audit va penetration test qilish** boâ€˜yicha real misollar bilan tushuntiraman. Bu yerda biz **Docker zaifliklarini aniqlash, exploit qilish va ularni bartaraf etish** usullarini koâ€˜rib chiqamiz.  

---

# **ðŸ”¥ Docker-da Audit va Penetration Test Oâ€˜tkazish**  

### **ðŸŽ¯ Maqsad:**  
âœ… Docker zaifliklarini **aniqlash**  
âœ… Docker konteynerlarini **penetration test qilish**  
âœ… Hujumchilar ishlatadigan **exploitlarni sinab koâ€˜rish**  
âœ… Docker xavfsizligini **mustahkamlash**  

---

## **ðŸ”¥ 1. Docker Audit: Zaifliklarni aniqlash**  

**ðŸ“Œ Docker tizimida zaifliklarni avtomatik aniqlash uchun 3 ta vosita ishlatamiz:**  

| **Tool** | **Funktsiya** |
|----------|--------------|
| **Docker Bench for Security** | Docker konteynerlarining xavfsizlik auditini oâ€˜tkazadi |
| **Trivy** | Docker image-lardagi zaifliklarni aniqlaydi |
| **Lynis** | Linux va Docker konfiguratsiyasini tekshiradi |

---

### **âœ… 1.1. Docker Bench for Security bilan audit qilish**  
```bash
git clone https://github.com/docker/docker-bench-security.git
cd docker-bench-security
sudo sh docker-bench-security.sh
```
ðŸ‘‰ **Natija:**  
```
[WARN] 1.1.1  - Ensure a separate partition for containers has been created
[PASS] 1.1.2  - Ensure the container host has been Hardened
[WARN] 1.2.1  - Ensure the version of Docker is up to date
```
ðŸš€ **Endi Docker tizimingiz qanchalik xavfsiz ekanligini bilasiz!**  

---

### **âœ… 1.2. Trivy bilan Docker image-larni skanerlash**  
```bash
sudo apt install -y trivy
trivy image nginx:latest
```
ðŸ‘‰ **Natija:**  
```
CRITICAL: CVE-2023-12345 - Buffer Overflow in nginx
HIGH: CVE-2023-67890 - SQL Injection vulnerability
```
ðŸš€ **Agar zaiflik boâ€˜lsa, Trivy uni topib beradi!**  

---

### **âœ… 1.3. Lynis bilan Docker host tizimini tekshirish**  
```bash
sudo apt install -y lynis
sudo lynis audit system
```
ðŸ‘‰ **Agar natija shunday boâ€˜lsa, tizim xavfsiz emas!**  
```
[WARNING] Docker service is running as root!
[WARNING] Insecure network configuration detected!
```
ðŸš€ **Endi bizda Docker host tizimining zaifliklari haqida toâ€˜liq maâ€™lumot bor!**  

---

## **ðŸ”¥ 2. Docker-da Penetration Test qilish**  

### **ðŸ“Œ Docker hujumlarini sinab koâ€˜rish uchun 3 ta eksploit ishlatamiz:**  

| **Hujum** | **Nima qilish mumkin?** |
|-----------|-------------------------|
| **Docker Escape Attack** | Konteynerdan chiqib, butun tizimni egallash |
| **Docker Privilege Escalation** | Konteyner ichida root huquqlarini olish |
| **Docker API Exploitation** | Ochiq Docker API orqali hujum qilish |

---

### **âœ… 2.1. Docker Escape Attack (Konteynerdan chiqish hujumi)**  

**ðŸ›‘ Hujum usuli:**  
1. Agar Docker konteyneri `--privileged` rejimda ishga tushgan boâ€˜lsa, hujumchi host tizimga chiqib olishi mumkin.  

2. **Konteyner ichiga kiramiz:**  
```bash
docker run --rm -it --privileged ubuntu bash
```
3. **Host tizimga chiqamiz:**  
```bash
mount -t proc /proc /mnt
chroot /mnt /bin/bash
whoami  # Agar natija "root" boâ€˜lsa, hujum muvaffaqiyatli!
```
ðŸ‘‰ **Agar biz `root` boâ€˜lib olgan boâ€˜lsak, konteynerdan butun tizimni egallash mumkin!**  

### **ðŸ›¡ Himoyalanish usuli:**  
âœ… **`--privileged` rejimda konteyner ishga tushirmang!**  
```bash
docker run --privileged=false -d nginx
```
âœ… **AppArmor yoki Seccomp qoâ€˜llash**  
```bash
docker run --security-opt seccomp=default.json -d nginx
```

---

### **âœ… 2.2. Docker Privilege Escalation (Root huquqini olish)**  

**ðŸ›‘ Hujum usuli:**  
1. Konteyner ichida root user mavjud boâ€˜lsa, hujumchi ushbu buyruqlar orqali root huquqini olishi mumkin:  
```bash
docker run -it --rm --user 0 nginx /bin/sh
whoami  # Agar natija "root" boâ€˜lsa, xavfli!
```

### **ðŸ›¡ Himoyalanish usuli:**  
âœ… **Root user oâ€˜rniga oddiy user ishlatish**  
```bash
docker run --user 1001 -d nginx
```
âœ… **Konteynerda yangi privilege olishni bloklash**  
```bash
docker run --security-opt no-new-privileges:true -d nginx
```

---

### **âœ… 2.3. Docker API Exploitation (Ochiq Docker API orqali hujum)**  

**ðŸ›‘ Hujum usuli:**  
1. **Docker API porti ochiq boâ€˜lsa, hujumchi tizimga kira oladi:**  
```bash
curl -X GET http://localhost:2375/containers/json
```
ðŸ‘‰ **Agar Docker konteyner roâ€˜yxati chiqsa, hujumchi tizimni boshqarishi mumkin!**  

2. **Yangi konteyner yaratish (Hacker konteyneri)**  
```bash
curl -X POST -H "Content-Type: application/json" \
    --data '{"Image":"alpine","Cmd":["/bin/sh"]}' \
    http://localhost:2375/containers/create
```

### **ðŸ›¡ Himoyalanish usuli:**  
âœ… **Docker API portini yopish**  
```bash
iptables -A INPUT -p tcp --dport 2375 -j DROP
```
âœ… **Docker APIâ€™ni faqat autentifikatsiyadan oâ€˜tgan foydalanuvchilarga ruxsat berish**  
```bash
vim /etc/docker/daemon.json
```
```json
{
  "tls": true,
  "tlsverify": true,
  "tlscacert": "/path/to/ca.pem",
  "tlscert": "/path/to/server-cert.pem",
  "tlskey": "/path/to/server-key.pem"
}
```
âœ… **Fail2Ban bilan API hujumlarini bloklash**  
```bash
sudo nano /etc/fail2ban/jail.local
```
```ini
[docker-api]
enabled = true
filter = docker-api
logpath = /var/log/syslog
maxretry = 3
bantime = 3600
```

---

## **ðŸ”¥ Yakuniy Xulosa**  

ðŸš€ **Endi siz Docker tizimini audit qilib, penetration test oâ€˜tkaza olasiz!**  

âœ… **Docker zaifliklarini qanday topdik?**  
- **Docker Bench for Security** â€“ Docker xavfsizligini tekshirdi  
- **Trivy** â€“ Docker image-lardagi zaifliklarni aniqladi  
- **Lynis** â€“ Docker host tizimini audit qildi  

âœ… **Docker hujumlarini qanday sinab koâ€˜rdik?**  
- **Docker Escape Attack** â€“ Konteynerdan butun tizimni egallash  
- **Docker Privilege Escalation** â€“ Root huquqini olish  
- **Docker API Exploitation** â€“ Ochiq API orqali hujum qilish  

ðŸ”¥ **Keyingi bosqich:**  
ðŸ‘‰ **Docker uchun xavfsizlik devops (DevSecOps) strategiyalarini oâ€˜rganmoqchimisiz?** ðŸ˜Š
